<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é¡¯ç¤ºä½ å‘¨é­çš„XXX</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    :root{ --primary:#e53935; }
    body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:1rem;}
    #map{width:100%;height:400px;margin-top:10px;}
    /* ç´…è‰²åŠé€æ˜æ³¢ç´‹ */
    .pulse-marker{
      position:relative;width:16px;height:16px;border-radius:50%;
      background:rgba(255,0,0,0.55);
    }
    .pulse-marker::before,.pulse-marker::after{
      content:"";position:absolute;left:50%;top:50%;width:100%;height:100%;border-radius:50%;
      background:rgba(255,0,0,0.35);transform:translate(-50%,-50%) scale(0.8);
      animation:pulse 2.5s infinite;
    }
    .pulse-marker::after{animation-delay:1.25s;}
    @keyframes pulse{0%{transform:translate(-50%,-50%) scale(.8);opacity:.8;}70%{transform:translate(-50%,-50%) scale(3);opacity:0;}100%{opacity:0;}}
    #status{margin-top:.5rem;color:#555;font-size:.9rem;}
  </style>
</head>
<body>
  <h1>é¡¯ç¤ºä½ å‘¨é­çš„XXX</h1>
  <p><em>è‹¥ç€è¦½å™¨è·³å‡ºå®šä½å°è©±æ¡†ï¼Œè«‹é»é¸ã€Œå…è¨±ã€ä»¥é¡¯ç¤ºæ‚¨å‘¨é­çš„æœ€æ–°å‹•æ…‹ï¼</em></p>
  <span id="status"></span>
  <p style="margin-top:1rem"><strong>åœ°åœ–ä½ç½®åˆ†äº«: </strong>
    <button onclick="copyLink()"> ğŸ”— è¤‡è£½åœ°åœ–é€£çµ</button>
  </p>
  <div id="map"></div>

<script>
let map, marker, layerGroup, latestMapURL='';
const statusEl=document.getElementById('status');

function decimalToDMS(deg,isLat=true){
  const dir=deg>=0?(isLat?'N':'E'):(isLat?'S':'W');
  const a=Math.abs(deg),d=Math.floor(a),mFloat=(a-d)*60,m=Math.floor(mFloat),s=Math.round((mFloat-m)*60*10)/10;
  return `${d}Â°${m}'${s}"${dir}`;
}
function addFixedMarkers(lat,lon){
  if(layerGroup) layerGroup.clearLayers();
  layerGroup=L.layerGroup();
  const pts=[{lat:lat+0.0005,lon:lon+0.0005},{lat:lat-0.0008,lon:lon-0.0005},{lat,lon:lon+0.0009}];
  const pulse=L.divIcon({className:'pulse-marker',iconSize:[16,16]});
  pts.forEach(p=>L.marker([p.lat,p.lon],{icon:pulse}).addTo(layerGroup));
  layerGroup.addTo(map);
}
function initMap(lat,lon){
  map=L.map('map').setView([lat,lon],15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
  marker=L.marker([lat,lon]).addTo(map);
  addFixedMarkers(lat,lon);
}
function updateLocation(pos){
  const {latitude:lat,longitude:lon}=pos.coords;
  statusEl.textContent='å®šä½æˆåŠŸï¼';
  latestMapURL=`https://www.google.com/maps/place/${encodeURIComponent(decimalToDMS(lat,true))}+${encodeURIComponent(decimalToDMS(lon,false))}`;
  if(!map){initMap(lat,lon);}else{map.setView([lat,lon]);marker.setLatLng([lat,lon]);addFixedMarkers(lat,lon);} }
function handleError(err){
  const msgs={1:'âŒ ä½¿ç”¨è€…æ‹’çµ•å®šä½æ¬Šé™',2:'âŒ ç„¡æ³•å–å¾—å®šä½è³‡è¨Š',3:'âŒ å–å¾—å®šä½é€¾æ™‚'};
  statusEl.textContent=msgs[err.code]||('âŒ éŒ¯èª¤:'+err.message);
}
async function requestLocation(){
  statusEl.textContent='è«‹ç¨å€™ï¼Œæ­£åœ¨å–å¾—å®šä½â€¦';
  if(!('geolocation' in navigator)){statusEl.textContent='ç€è¦½å™¨ä¸æ”¯æ´å®šä½';return;}
  try{
    if(navigator.permissions){
      const s=await navigator.permissions.query({name:'geolocation'});
      if(s.state==='denied'){statusEl.textContent='å®šä½æ¬Šé™è¢«å°é–ï¼Œè«‹åˆ°ç€è¦½å™¨è¨­å®šæ‰‹å‹•å…è¨±';return;}
    }
  }catch(e){}
  navigator.geolocation.getCurrentPosition(updateLocation,handleError,{enableHighAccuracy:true,timeout:10000});
}
window.addEventListener('load',requestLocation);
function copyLink(){latestMapURL?navigator.clipboard.writeText(latestMapURL).then(()=>alert('åœ°åœ–é€£çµå·²è¤‡è£½ï¼')):alert('åœ°åœ–å°šæœªå®šä½ï¼Œç„¡é€£çµå¯è¤‡è£½');}
</script>
</body>
</html>