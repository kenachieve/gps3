<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é¡¯ç¤ºä½ å‘¨é­çš„XXX</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    #map{width:100%;height:400px;margin-top:10px;}

    /* ç´…è‰²åŠé€æ˜æ³¢ç´‹ï¼ˆå¯è‡ªè¡Œèª¿æ•´å¯¬åº¦ã€é€æ˜åº¦ã€å‹•ç•«æ™‚é–“ç­‰ï¼‰ */
    .pulse-marker{
      position:relative;width:16px;height:16px;border-radius:50%;
      background:rgba(255,0,0,0.55);
    }
    .pulse-marker::before,
    .pulse-marker::after{
      content:"";position:absolute;left:50%;top:50%;
      width:100%;height:100%;border-radius:50%;
      background:rgba(255,0,0,0.35);
      transform:translate(-50%,-50%) scale(0.8);
      animation:pulse 2.5s infinite;
    }
    .pulse-marker::after{animation-delay:1.25s;}

    @keyframes pulse{
      0%  {transform:translate(-50%,-50%) scale(0.8);opacity:0.8;}
      70% {transform:translate(-50%,-50%) scale(3);opacity:0;}
      100%{opacity:0;}
    }

    /* â€”â€” å…è²¬è²æ˜æ¨£å¼ â€”â€” */
    .disclaimer{
      font-size:0.75rem;          /* å°å­—é«” */
      color:#666;                 /* æ·ºç°è‰² */
      text-align:center;
      margin:8px 0 16px 0;        /* èˆ‡åœ°åœ–ä¿æŒé©åº¦é–“è· */
      line-height:1.4;
    }
  </style>

  <script>
    /* === æ‚¨åŸæœ‰çš„ JavaScript å®Œå…¨ä¸è®Š === */
    let map, marker, layerGroup, latestMapURL='';

    function decimalToDMS(deg,isLat=true){
      const dir=deg>=0?(isLat?'N':'E'):(isLat?'S':'W');
      const a=Math.abs(deg),d=Math.floor(a),
            mFloat=(a-d)*60,m=Math.floor(mFloat),
            s=Math.round((mFloat-m)*60*10)/10;
      return `${d}Â°${m}'${s}"${dir}`;
    }

    function addFixedMarkers(lat,lon){
      if(layerGroup) layerGroup.clearLayers();
      layerGroup=L.layerGroup();
      const pts=[
        {lat:lat+0.0005, lon:lon+0.0005},
        {lat:lat-0.0008, lon:lon-0.0005},
        {lat,            lon:lon+0.0009}
      ];
      const pulse=L.divIcon({className:'pulse-marker',iconSize:[16,16]});
      pts.forEach(p=>L.marker([p.lat,p.lon],{icon:pulse}).addTo(layerGroup));
      layerGroup.addTo(map);
    }

    function initMap(lat,lon){
      map=L.map('map').setView([lat,lon],45);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        attribution:'&copy; OpenStreetMap contributors'
      }).addTo(map);
      marker=L.marker([lat,lon]).addTo(map);
      addFixedMarkers(lat,lon);
    }

    function updateLocation(pos){
      const lat=pos.coords.latitude, lon=pos.coords.longitude;
      const url=`https://www.google.com/maps/place/${
          encodeURIComponent(decimalToDMS(lat,true))}+${
          encodeURIComponent(decimalToDMS(lon,false))}`;
      latestMapURL=url;

      if(!map){
        initMap(lat,lon);
      }else{
        map.setView([lat,lon],45);
        marker.setLatLng([lat,lon]);
        addFixedMarkers(lat,lon);
      }
    }

    function getLocation(){
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(updateLocation,
          ()=>console.warn("ç„¡æ³•ç²å–ä½ç½®"),{enableHighAccuracy:true});
      }else{
        console.warn("ç€è¦½å™¨ä¸æ”¯æ´ GPS");
      }
    }

    function copyLink(){
      if(latestMapURL){
        navigator.clipboard.writeText(latestMapURL)
          .then(()=>alert("åœ°åœ–é€£çµå·²è¤‡è£½ï¼"));
      }else{
        alert("åœ°åœ–å°šæœªå®šä½ï¼Œç„¡é€£çµå¯è¤‡è£½");
      }
    }
  </script>
</head>

<body onload="getLocation()">
  <h1>é¡¯ç¤ºä½ å‘¨é­çš„XXX</h1>

  <p><em>é»æ“Šã€Œç¢ºå®šã€ç«‹å³æŸ¥çœ‹æ‚¨æ‰€åœ¨å€åŸŸçš„æœ€æ–°å‹•æ…‹ï¼</em></p>

  <p><strong>åœ°åœ–ä½ç½®åˆ†äº«: </strong>
     <button onclick="copyLink()"> ğŸ”— è¤‡è£½åœ°åœ–é€£çµ</button>
  </p>

  <div id="map"></div>

  <!-- â€”â€” å…è²¬è²æ˜ â€”â€” -->
  <p class="disclaimer">
    å…è²¬è²æ˜ï¼šæœ¬ç¶²ç«™åœ°åœ–è³‡æ–™éƒ¨åˆ†ä¾†æºç‚ºä½¿ç”¨è€…æä¾›åŠç¶²è·¯å…¬é–‹è³‡è¨Šï¼Œåƒ…ä¾›åƒè€ƒç”¨é€”ã€‚<br>
    æœ¬ç«™ä¸ä¿è­‰å…§å®¹çš„çµ•å°æ­£ç¢ºã€å®Œæ•´æˆ–æœ€æ–°ç‹€æ…‹ï¼Œäº¦ä¸æ‡‰ä½œç‚ºæ­£å¼æ–‡ä»¶ã€æ±ºç­–ä¾æ“šæˆ–æ¡å–è¡Œå‹•ä¹‹å”¯ä¸€åƒè€ƒã€‚
  </p>
</body>
</html>
